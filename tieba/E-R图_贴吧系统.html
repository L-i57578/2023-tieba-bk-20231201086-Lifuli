<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´´å§ç³»ç»ŸE-Rå›¾</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        .er-container {
            background: linear-gradient(135deg, #a3bded 0%, #6991c7 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .er-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin: 20px auto;
            max-width: 1400px;
            overflow: hidden;
        }
        .er-header {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .er-content {
            padding: 30px;
            min-height: 800px;
        }
        .entity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .entity-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #74b9ff;
            transition: transform 0.3s ease;
        }
        .entity-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .relationship-section {
            background: #f0f7ff;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #ff6b6b;
        }
    </style>
</head>
<body class="er-container">
    <div class="er-card">
        <div class="er-header">
            <h1 class="text-3xl font-bold mb-2">è´´å§ç³»ç»ŸE-Rå›¾</h1>
            <p class="text-lg opacity-90">åŸºäº11ä¸ªåŠŸèƒ½æ¨¡å—çš„å®Œæ•´å®ä½“å…³ç³»å›¾</p>
        </div>
        
        <div class="er-content">
            <!-- Mermaid E-Rå›¾ -->
            <div class="mermaid">
erDiagram
    %% ç”¨æˆ·ç›¸å…³å®ä½“
    User {
        int id PK "ç”¨æˆ·ID"
        string username "ç”¨æˆ·å"
        string nickname "æ˜µç§°"
        string email "é‚®ç®±"
        string avatar "å¤´åƒ"
        string gender "æ€§åˆ«"
        date birthday "ç”Ÿæ—¥"
        string location "åœ°åŒº"
        int followers_count "ç²‰ä¸æ•°"
        int following_count "å…³æ³¨æ•°"
        datetime created_at "åˆ›å»ºæ—¶é—´"
    }
    
    UserFollow {
        int id PK "å…³æ³¨ID"
        int follower_id FK "å…³æ³¨è€…ID"
        int following_id FK "è¢«å…³æ³¨è€…ID"
        datetime created_at "å…³æ³¨æ—¶é—´"
    }
    
    %% è´´å§ç›¸å…³å®ä½“
    TiebaCategory {
        int id PK "åˆ†ç±»ID"
        string name "åˆ†ç±»åç§°"
        string description "åˆ†ç±»æè¿°"
        int sort_order "æ’åº"
    }
    
    Tieba {
        int id PK "è´´å§ID"
        string name "è´´å§åç§°"
        string description "è´´å§æè¿°"
        string avatar "è´´å§å¤´åƒ"
        int category_id FK "åˆ†ç±»ID"
        int creator_id FK "åˆ›å»ºè€…ID"
        int members_count "æˆå‘˜æ•°"
        int posts_count "å¸–å­æ•°"
        datetime created_at "åˆ›å»ºæ—¶é—´"
    }
    
    TiebaMember {
        int id PK "æˆå‘˜ID"
        int tieba_id FK "è´´å§ID"
        int user_id FK "ç”¨æˆ·ID"
        string role "è§’è‰²"
        int level "ç­‰çº§"
        datetime joined_at "åŠ å…¥æ—¶é—´"
    }
    
    TiebaFollow {
        int id PK "å…³æ³¨ID"
        int user_id FK "ç”¨æˆ·ID"
        int tieba_id FK "è´´å§ID"
        datetime created_at "å…³æ³¨æ—¶é—´"
    }
    
    %% å¸–å­ç›¸å…³å®ä½“
    Post {
        int id PK "å¸–å­ID"
        string title "å¸–å­æ ‡é¢˜"
        text content "å¸–å­å†…å®¹"
        int author_id FK "ä½œè€…ID"
        int tieba_id FK "è´´å§ID"
        string post_type "å¸–å­ç±»å‹"
        int views_count "æµè§ˆæ•°"
        int likes_count "ç‚¹èµæ•°"
        int comments_count "è¯„è®ºæ•°"
        datetime created_at "åˆ›å»ºæ—¶é—´"
    }
    
    PostImage {
        int id PK "å›¾ç‰‡ID"
        int post_id FK "å¸–å­ID"
        string image "å›¾ç‰‡è·¯å¾„"
        string caption "å›¾ç‰‡è¯´æ˜"
        int sort_order "æ’åº"
    }
    
    Comment {
        int id PK "è¯„è®ºID"
        int post_id FK "å¸–å­ID"
        int author_id FK "è¯„è®ºè€…ID"
        text content "è¯„è®ºå†…å®¹"
        int parent_id FK "çˆ¶è¯„è®ºID"
        int reply_to_id FK "å›å¤ç»™ID"
        int likes_count "ç‚¹èµæ•°"
        datetime created_at "åˆ›å»ºæ—¶é—´"
    }
    
    PostLike {
        int id PK "ç‚¹èµID"
        int post_id FK "å¸–å­ID"
        int user_id FK "ç”¨æˆ·ID"
        datetime created_at "ç‚¹èµæ—¶é—´"
    }
    
    CommentLike {
        int id PK "ç‚¹èµID"
        int comment_id FK "è¯„è®ºID"
        int user_id FK "ç”¨æˆ·ID"
        datetime created_at "ç‚¹èµæ—¶é—´"
    }
    
    PostCollection {
        int id PK "æ”¶è—ID"
        int post_id FK "å¸–å­ID"
        int user_id FK "ç”¨æˆ·ID"
        datetime created_at "æ”¶è—æ—¶é—´"
    }
    
    %% æ¶ˆæ¯ç›¸å…³å®ä½“
    UserMessage {
        int id PK "æ¶ˆæ¯ID"
        int sender_id FK "å‘é€è€…ID"
        int receiver_id FK "æ¥æ”¶è€…ID"
        string message_type "æ¶ˆæ¯ç±»å‹"
        text content "æ¶ˆæ¯å†…å®¹"
        bool is_read "æ˜¯å¦å·²è¯»"
        datetime created_at "å‘é€æ—¶é—´"
    }
    
    %% å…³ç³»å®šä¹‰
    User ||--o{ UserFollow : "å…³æ³¨"
    User ||--o{ Tieba : "åˆ›å»º"
    User ||--o{ TiebaMember : "åŠ å…¥"
    User ||--o{ TiebaFollow : "å…³æ³¨è´´å§"
    User ||--o{ Post : "å‘å¸ƒ"
    User ||--o{ Comment : "è¯„è®º"
    User ||--o{ PostLike : "ç‚¹èµå¸–å­"
    User ||--o{ CommentLike : "ç‚¹èµè¯„è®º"
    User ||--o{ PostCollection : "æ”¶è—å¸–å­"
    User ||--o{ UserMessage : "å‘é€/æ¥æ”¶æ¶ˆæ¯"
    
    TiebaCategory ||--o{ Tieba : "åˆ†ç±»"
    Tieba ||--o{ TiebaMember : "æ‹¥æœ‰æˆå‘˜"
    Tieba ||--o{ TiebaFollow : "è¢«å…³æ³¨"
    Tieba ||--o{ Post : "åŒ…å«å¸–å­"
    
    Post ||--o{ PostImage : "åŒ…å«å›¾ç‰‡"
    Post ||--o{ Comment : "åŒ…å«è¯„è®º"
    Post ||--o{ PostLike : "è¢«ç‚¹èµ"
    Post ||--o{ PostCollection : "è¢«æ”¶è—"
    
    Comment ||--o{ Comment : "å›å¤"
    Comment ||--o{ CommentLike : "è¢«ç‚¹èµ"
            </div>
            
            <!-- å®ä½“è¯¦ç»†è¯´æ˜ -->
            <div class="relationship-section">
                <h3 class="text-xl font-semibold text-red-600 mb-3">ğŸ”— ä¸»è¦å…³ç³»è¯´æ˜</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-semibold text-blue-600 mb-2">ç”¨æˆ·å…³ç³»</h4>
                        <ul class="space-y-1 text-sm">
                            <li>â€¢ ç”¨æˆ·-ç”¨æˆ·ï¼šå…³æ³¨å…³ç³»ï¼ˆå¤šå¯¹å¤šï¼‰</li>
                            <li>â€¢ ç”¨æˆ·-è´´å§ï¼šåˆ›å»ºã€åŠ å…¥ã€å…³æ³¨å…³ç³»</li>
                            <li>â€¢ ç”¨æˆ·-å¸–å­ï¼šå‘å¸ƒã€ç‚¹èµã€æ”¶è—å…³ç³»</li>
                            <li>â€¢ ç”¨æˆ·-è¯„è®ºï¼šå‘å¸ƒã€ç‚¹èµå…³ç³»</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-blue-600 mb-2">å†…å®¹å…³ç³»</h4>
                        <ul class="space-y-1 text-sm">
                            <li>â€¢ è´´å§-å¸–å­ï¼šåŒ…å«å…³ç³»ï¼ˆä¸€å¯¹å¤šï¼‰</li>
                            <li>â€¢ å¸–å­-è¯„è®ºï¼šåŒ…å«å…³ç³»ï¼ˆä¸€å¯¹å¤šï¼‰</li>
                            <li>â€¢ å¸–å­-å›¾ç‰‡ï¼šåŒ…å«å…³ç³»ï¼ˆä¸€å¯¹å¤šï¼‰</li>
                            <li>â€¢ è¯„è®º-è¯„è®ºï¼šå›å¤å…³ç³»ï¼ˆè‡ªå…³è”ï¼‰</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- å®ä½“ç½‘æ ¼ -->
            <div class="entity-grid">
                <div class="entity-card">
                    <h3 class="text-xl font-semibold text-blue-600 mb-3">ğŸ‘¤ ç”¨æˆ·å®ä½“</h3>
                    <ul class="space-y-2">
                        <li>â€¢ <strong>User</strong>ï¼šç”¨æˆ·åŸºæœ¬ä¿¡æ¯</li>
                        <li>â€¢ <strong>UserFollow</strong>ï¼šç”¨æˆ·å…³æ³¨å…³ç³»</li>
                        <li>â€¢ <strong>TiebaMember</strong>ï¼šè´´å§æˆå‘˜å…³ç³»</li>
                        <li>â€¢ <strong>TiebaFollow</strong>ï¼šè´´å§å…³æ³¨å…³ç³»</li>
                        <li>â€¢ <strong>UserMessage</strong>ï¼šç”¨æˆ·æ¶ˆæ¯ç³»ç»Ÿ</li>
                    </ul>
                </div>
                
                <div class="entity-card">
                    <h3 class="text-xl font-semibold text-blue-600 mb-3">ğŸ  è´´å§å®ä½“</h3>
                    <ul class="space-y-2">
                        <li>â€¢ <strong>TiebaCategory</strong>ï¼šè´´å§åˆ†ç±»</li>
                        <li>â€¢ <strong>Tieba</strong>ï¼šè´´å§åŸºæœ¬ä¿¡æ¯</li>
                        <li>â€¢ <strong>TiebaMember</strong>ï¼šè´´å§æˆå‘˜ç®¡ç†</li>
                        <li>â€¢ <strong>TiebaFollow</strong>ï¼šè´´å§å…³æ³¨å…³ç³»</li>
                        <li>â€¢ æ”¯æŒå¤šçº§åˆ†ç±»å’Œæƒé™ç®¡ç†</li>
                    </ul>
                </div>
                
                <div class="entity-card">
                    <h3 class="text-xl font-semibold text-blue-600 mb-3">ğŸ“ å¸–å­å®ä½“</h3>
                    <ul class="space-y-2">
                        <li>â€¢ <strong>Post</strong>ï¼šå¸–å­ä¸»ä½“å†…å®¹</li>
                        <li>â€¢ <strong>PostImage</strong>ï¼šå¸–å­å›¾ç‰‡é™„ä»¶</li>
                        <li>â€¢ <strong>Comment</strong>ï¼šè¯„è®ºç³»ç»Ÿ</li>
                        <li>â€¢ <strong>PostLike</strong>ï¼šå¸–å­ç‚¹èµ</li>
                        <li>â€¢ <strong>PostCollection</strong>ï¼šå¸–å­æ”¶è—</li>
                    </ul>
                </div>
                
                <div class="entity-card">
                    <h3 class="text-xl font-semibold text-blue-600 mb-3">ğŸ’¬ äº’åŠ¨å®ä½“</h3>
                    <ul class="space-y-2">
                        <li>â€¢ <strong>CommentLike</strong>ï¼šè¯„è®ºç‚¹èµ</li>
                        <li>â€¢ <strong>UserMessage</strong>ï¼šç§ä¿¡ç³»ç»Ÿ</li>
                        <li>â€¢ æ”¯æŒæ¥¼ä¸­æ¥¼å›å¤</li>
                        <li>â€¢ æ”¯æŒå¤šçº§è¯„è®ºç»“æ„</li>
                        <li>â€¢ å®Œæ•´çš„äº’åŠ¨ç»Ÿè®¡</li>
                    </ul>
                </div>
            </div>
            
            <!-- åŠŸèƒ½æ¨¡å—æ˜ å°„ -->
            <div class="relationship-section">
                <h3 class="text-xl font-semibold text-red-600 mb-3">ğŸ¯ åŠŸèƒ½æ¨¡å—ä¸å®ä½“æ˜ å°„</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-semibold text-blue-600 mb-2">æ ¸å¿ƒåŠŸèƒ½æ¨¡å—</h4>
                        <ul class="space-y-1 text-sm">
                            <li>â€¢ <strong>ä¸ªäººä¿¡æ¯</strong>ï¼šUserå®ä½“ + ç»Ÿè®¡ä¿¡æ¯</li>
                            <li>â€¢ <strong>å‘å¸ƒä¸­å¿ƒ</strong>ï¼šPostå®ä½“ + å…³è”å®ä½“</li>
                            <li>â€¢ <strong>å§å¹¿åœº</strong>ï¼šTiebaå®ä½“ + åˆ†ç±»ç³»ç»Ÿ</li>
                            <li>â€¢ <strong>å¸–å­è¯¦æƒ…</strong>ï¼šPost + Comment + äº’åŠ¨å®ä½“</li>
                            <li>â€¢ <strong>æ³¨å†Œç™»å½•</strong>ï¼šUserå®ä½“è®¤è¯ç³»ç»Ÿ</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-blue-600 mb-2">ç¤¾äº¤åŠŸèƒ½æ¨¡å—</h4>
                        <ul class="space-y-1 text-sm">
                            <li>â€¢ <strong>æ¶ˆæ¯ç³»ç»Ÿ</strong>ï¼šUserMessageå®ä½“</li>
                            <li>â€¢ <strong>å…³æ³¨ç³»ç»Ÿ</strong>ï¼šUserFollow + TiebaFollow</li>
                            <li>â€¢ <strong>äº’åŠ¨åŠŸèƒ½</strong>ï¼šLike + Collectionå®ä½“</li>
                            <li>â€¢ <strong>è´´å§ç®¡ç†</strong>ï¼šTiebaMemberæƒé™ç³»ç»Ÿ</li>
                            <li>â€¢ <strong>é¦–é¡µæ¨è</strong>ï¼šåŸºäºæ‰€æœ‰å®ä½“çš„èšåˆ</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            er: {
                useMaxWidth: true,
                diagramPadding: 20
            }
        });
    </script>
</body>
</html>