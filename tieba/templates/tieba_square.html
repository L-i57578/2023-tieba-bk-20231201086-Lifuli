{% extends "base.html" %}
{% load static %}

{% block title %}贴吧广场 - 百度贴吧{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <!-- 搜索和筛选 -->
    <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
        <form method="get" action="{% url 'tieba_square' %}" class="flex flex-col md:flex-row gap-4 items-center justify-between">
            <div class="flex-1 w-full md:w-auto">
                <div class="relative">
                    <input type="text" name="search" placeholder="搜索贴吧..." value="{{ search_query }}" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-300">
                    <button type="submit" class="absolute right-3 top-3 text-gray-400 hover:text-primary transition-colors duration-300">
                        <i class="fa fa-search"></i>
                    </button>
                </div>
            </div>
            <div class="flex space-x-2">
                <button type="submit" name="sort" value="all" class="px-6 py-3 {% if sort_by == 'all' %}bg-gradient-to-r from-blue-600 to-purple-600 text-white{% else %}bg-white border border-gray-200 text-dark{% endif %} rounded-xl hover:from-blue-700 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1">全部</button>
                <button type="submit" name="sort" value="hot" class="px-6 py-3 {% if sort_by == 'hot' %}bg-gradient-to-r from-blue-600 to-purple-600 text-white{% else %}bg-white border border-gray-200 text-dark{% endif %} rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 shadow-sm hover:shadow-md">热门</button>
                <button type="submit" name="sort" value="new" class="px-6 py-3 {% if sort_by == 'new' %}bg-gradient-to-r from-blue-600 to-purple-600 text-white{% else %}bg-white border border-gray-200 text-dark{% endif %} rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 shadow-sm hover:shadow-md">新吧</button>
                <button type="submit" name="sort" value="recommend" class="px-6 py-3 {% if sort_by == 'recommend' %}bg-gradient-to-r from-blue-600 to-purple-600 text-white{% else %}bg-white border border-gray-200 text-dark{% endif %} rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 shadow-sm hover:shadow-md">推荐</button>
            </div>
        </form>
    </div>
    
    <!-- 最新帖子区域 -->
    {% if latest_posts %}
    <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">最新帖子</h2>
        <div class="space-y-4">
            {% for post in latest_posts %}
            <a href="{% url 'post_detail' pk=post.id %}" class="block p-6 hover:shadow-lg rounded-xl transition-all duration-300 border border-gray-100 hover:border-blue-100 bg-white">
                <div class="flex items-start">
                    <div class="relative">
                        <img src="{% static 'images/placeholder-100x100.svg' %}" alt="用户头像" class="w-10 h-10 rounded-full object-cover border-2 border-white shadow-md flex-shrink-0">
                        <div class="absolute -bottom-1 -right-1 w-2 h-2 bg-green-400 border-2 border-white rounded-full"></div>
                    </div>
                    <div class="ml-4 flex-1">
                        <div class="flex items-center justify-between">
                            <h3 class="font-bold text-gray-900 text-lg">{{ post.author.username|default:"匿名用户" }}</h3>
                            <span class="text-sm text-gray-500">{{ post.created_at|timesince }}前</span>
                        </div>
                        <h4 class="font-bold bg-gradient-to-r from-gray-900 to-blue-900 bg-clip-text text-transparent mt-2 text-lg line-clamp-2">{{ post.title }}</h4>
                        <p class="text-gray-700 text-base leading-relaxed mt-2 line-clamp-2">{{ post.content|truncatechars:80 }}</p>
                        
                        <!-- 帖子图片预览 -->
                        {% if post.images.exists %}
                        <div class="mt-3">
                            <div class="grid grid-cols-3 gap-2">
                                {% for image in post.images.all|slice:":3" %}
                                <div class="relative">
                                    <img src="{{ image.image.url }}" alt="帖子图片" class="w-full h-20 object-cover rounded-lg">
                                    {% if forloop.last and post.images.count > 3 %}
                                    <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg">
                                        <span class="text-white text-sm font-semibold">+{{ post.images.count|add:"-3" }}</span>
                                    </div>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        <div class="mt-3 flex items-center text-gray-600 space-x-4">
                            <div class="flex items-center px-3 py-1 bg-red-50 rounded-full text-sm">
                                <i class="fa fa-thumbs-up mr-1 text-red-500"></i>
                                <span class="font-semibold">{{ post.likes_count|default:0 }}</span>
                            </div>
                            <div class="flex items-center px-3 py-1 bg-blue-50 rounded-full text-sm">
                                <i class="fa fa-comment mr-1 text-blue-500"></i>
                                <span class="font-semibold">{{ post.comments_count|default:0 }}</span>
                            </div>
                            <div class="flex items-center px-3 py-1 bg-green-50 rounded-full text-sm">
                                <i class="fa fa-eye mr-1 text-green-500"></i>
                                <span class="font-semibold">{{ post.views_count|default:0 }}</span>
                            </div>
                            <span class="text-sm text-gray-500">来自：{{ post.tieba.name }}</span>
                        </div>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- 分类导航 -->
    <div class="bg-white rounded-xl shadow-sm p-4 mb-6">
        <form method="get" action="{% url 'tieba_square' %}" class="flex flex-wrap gap-3">
            {% if search_query %}<input type="hidden" name="search" value="{{ search_query }}">{% endif %}
            {% if sort_by %}<input type="hidden" name="sort" value="{{ sort_by }}">{% endif %}
            
            <button type="submit" name="category" value="" class="px-6 py-3 {% if not category_filter %}bg-gradient-to-r from-blue-600 to-purple-600 text-white{% else %}bg-white border border-gray-200 text-dark{% endif %} rounded-xl hover:from-blue-700 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1 whitespace-nowrap">全部</button>
            <button type="submit" name="category" value="游戏" class="px-6 py-3 {% if category_filter == '游戏' %}bg-gradient-to-r from-blue-600 to-purple-600 text-white{% else %}bg-white border border-gray-200 text-dark{% endif %} rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 shadow-sm hover:shadow-md whitespace-nowrap">游戏</button>
            <button type="submit" name="category" value="动漫" class="px-6 py-3 {% if category_filter == '动漫' %}bg-gradient-to-r from-blue-600 to-purple-600 text-white{% else %}bg-white border border-gray-200 text-dark{% endif %} rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 shadow-sm hover:shadow-md whitespace-nowrap">动漫</button>
            <button type="submit" name="category" value="影视" class="px-6 py-3 {% if category_filter == '影视' %}bg-gradient-to-r from-blue-600 to-purple-600 text-white{% else %}bg-white border border-gray-200 text-dark{% endif %} rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 shadow-sm hover:shadow-md whitespace-nowrap">影视</button>
            <button type="submit" name="category" value="音乐" class="px-6 py-3 {% if category_filter == '音乐' %}bg-gradient-to-r from-blue-600 to-purple-600 text-white{% else %}bg-white border border-gray-200 text-dark{% endif %} rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 shadow-sm hover:shadow-md whitespace-nowrap">音乐</button>
            <button type="submit" name="category" value="体育" class="px-6 py-3 {% if category_filter == '体育' %}bg-gradient-to-r from-blue-600 to-purple-600 text-white{% else %}bg-white border border-gray-200 text-dark{% endif %} rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 shadow-sm hover:shadow-md whitespace-nowrap">体育</button>
            <button type="submit" name="category" value="科技" class="px-6 py-3 {% if category_filter == '科技' %}bg-gradient-to-r from-blue-600 to-purple-600 text-white{% else %}bg-white border border-gray-200 text-dark{% endif %} rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 shadow-sm hover:shadow-md whitespace-nowrap">科技</button>
            <button type="submit" name="category" value="生活" class="px-6 py-3 {% if category_filter == '生活' %}bg-gradient-to-r from-blue-600 to-purple-600 text-white{% else %}bg-white border border-gray-200 text-dark{% endif %} rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 shadow-sm hover:shadow-md whitespace-nowrap">生活</button>
            <button type="submit" name="category" value="时尚" class="px-6 py-3 {% if category_filter == '时尚' %}bg-gradient-to-r from-blue-600 to-purple-600 text-white{% else %}bg-white border border-gray-200 text-dark{% endif %} rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 shadow-sm hover:shadow-md whitespace-nowrap">时尚</button>
            <button type="submit" name="category" value="美食" class="px-6 py-3 {% if category_filter == '美食' %}bg-gradient-to-r from-blue-600 to-purple-600 text-white{% else %}bg-white border border-gray-200 text-dark{% endif %} rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 shadow-sm hover:shadow-md whitespace-nowrap">美食</button>
            <button type="submit" name="category" value="旅行" class="px-6 py-3 {% if category_filter == '旅行' %}bg-gradient-to-r from-blue-600 to-purple-600 text-white{% else %}bg-white border border-gray-200 text-dark{% endif %} rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 shadow-sm hover:shadow-md whitespace-nowrap">旅行</button>
            <button type="submit" name="category" value="摄影" class="px-6 py-3 {% if category_filter == '摄影' %}bg-gradient-to-r from-blue-600 to-purple-600 text-white{% else %}bg-white border border-gray-200 text-dark{% endif %} rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 shadow-sm hover:shadow-md whitespace-nowrap">摄影</button>
        </form>
    </div>
    
    <!-- 贴吧列表 -->
    {% if tiebas %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for tieba in tiebas %}
        <div class="bg-white rounded-xl shadow-sm overflow-hidden hover:shadow-md transition">
            <div class="relative">
                <img src="{% static 'images/placeholder-800x200.svg' %}" alt="{{ tieba.name }}封面" class="w-full h-32 object-cover">
                <div class="absolute -bottom-8 left-4">
                    <img src="{% static 'images/placeholder-100x100.svg' %}" alt="{{ tieba.name }}图标" class="w-16 h-16 rounded-full border-4 border-white object-cover">
                </div>
            </div>
            <div class="p-4 pt-10">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="font-bold text-lg text-dark">{{ tieba.name }}</h3>
                    <button class="px-3 py-1 bg-primary text-white text-sm rounded-full hover:bg-primary/90 transition">
                        关注
                    </button>
                </div>
                <p class="text-sm text-gray-600 mb-3 line-clamp-2">{{ tieba.description|default:"欢迎来到"|add:tieba.name }}</p>
                <div class="flex justify-between text-sm text-gray-500">
                    <span>{{ tieba.members_count|default:0 }}关注</span>
                    <span>今日: {{ tieba.today_posts_count|default:0 }}帖子</span>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <!-- 空状态 -->
    <div class="bg-white rounded-xl shadow-sm p-12 text-center">
        <div class="max-w-md mx-auto">
            <i class="fa fa-search text-gray-300 text-6xl mb-4"></i>
            <h3 class="text-xl font-bold text-gray-700 mb-2">
                {% if search_query %}没有找到匹配的贴吧{% else %}暂无贴吧{% endif %}
            </h3>
            <p class="text-gray-500 mb-6">
                {% if search_query %}
                请尝试使用其他关键词搜索，或浏览其他分类
                {% else %}
                贴吧列表为空，请稍后再来查看
                {% endif %}
            </p>
            {% if search_query %}
            <a href="{% url 'tieba_square' %}" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:from-blue-700 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl inline-block">
                查看全部贴吧
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}
    
    <!-- 分页 -->
    <div class="flex justify-center mt-12">
        <div class="flex space-x-3">
            <button class="px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:from-blue-700 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl">1</button>
            <button class="px-6 py-3 bg-white border border-gray-200 text-dark rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 shadow-sm hover:shadow-md">2</button>
            <button class="px-6 py-3 bg-white border border-gray-200 text-dark rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 shadow-sm hover:shadow-md">3</button>
            <button class="px-6 py-3 bg-white border border-gray-200 text-dark rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 shadow-sm hover:shadow-md">4</button>
            <button class="px-6 py-3 bg-white border border-gray-200 text-dark rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 shadow-sm hover:shadow-md">5</button>
            <button class="px-6 py-3 bg-white border border-gray-200 text-dark rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 shadow-sm hover:shadow-md">下一页</button>
        </div>
    </div>
</div>
{% endblock %}